<html><head></head><body><dom-module id="page-sending"><template><style>:host{display:block;height:100%;overflow:auto;}.chart{height:280px;margin:0 auto;}#container{height:35%;padding:0 200px 0 180px;}.detail{border-top:1px solid rgb(221, 221, 221);height:calc(65% - 1px);}date-daily{position:relative;float:right;margin-right:7px;margin-top:5px;}.chart_group{height:100%;}.chart_group > div{float:left;}.chart{height:280px;margin:0px;margin-right:200px;width:calc(100% - 400px);}.header_chart{color:white;width:200px;height:280px;line-height:280px;text-align:center;}.header_chart > p{vertical-align:middle;margin:0px;line-height:1.5;display:inline-block;}.tpb_font{font-family:'Prompt', sans-serif;}</style><div id="container"></div><div class="detail"><date-daily date-selected="[[dateSelected]]" date-daily-selected="{{dateDailySelected}}"></date-daily><div id="linechart" class="chart_group"></div></div></template><script>class PageSending extends Polymer.Element{static get is(){return"page-sending"}static get properties(){return{dataLoaded:{type:Array,observer:"onDataChanged"},dateDailySelected:{type:String,notify:!0},batteryDailyData:{type:Array,observer:"onBatteryDailyDataChanged"},signalDailyData:{type:Array,observer:"onSignalDailyDataChanged"},dataList:{type:Object,value:{}},chart:Object}}onDataChanged(dataLoaded){if(dataLoaded){var observedData=dataLoaded[0].data,yCategories=[],dataList=[];for(let index=0;index<observedData.length;index++){const element=observedData[index];var observed_timestamp=element.observed_timestamp,observed_timestampSplit=observed_timestamp.split(" "),date=observed_timestampSplit[0],time=observed_timestampSplit[1];if(-1===yCategories.indexOf(date)){yCategories.push(date)}var dateSplit=date.split("-"),dateUTC=Date.UTC(parseInt(dateSplit[0]),parseInt(dateSplit[1])-1,parseInt(dateSplit[2])),timeSplit=time.split(":"),timeData=(60*parseInt(timeSplit[0])+parseInt(timeSplit[1]))/5,b=moment(date),data;if(element.delay){var hTotal=0,h=element.delay.hours,day=element.delay.days;if(day){var hDay=24*day;hTotal+=hDay}if(h){hTotal+=h}data=[b.toDate().getTime(),timeData,hTotal]}else{data=[b.toDate().getTime(),timeData,null]}dataList.push(data)}var minDate=yCategories[0].split("-"),maxDate=yCategories[yCategories.length-1].split("-");Highcharts.chart(this.$.container,{chart:{type:"heatmap",backgroundColor:"rgba(255, 255, 255, 0.0)",inverted:!0},title:{text:"",align:"left"},tooltip:{pointFormat:"{point.y}",headerFormat:"",shadow:!1,style:{fontSize:"14px",fontFamily:"Prompt, sans-serif"},valueDecimals:1},xAxis:{className:"tpb_font",tickPixelInterval:50,reversed:!1,min:moment(yCategories[0]).toDate().getTime(),max:moment(yCategories[yCategories.length-1]).toDate().getTime(),labels:{formatter:function(){var b=moment(this.value);return b.format("D MMM")}}},yAxis:{className:"tpb_font",title:{text:null},labels:{formatter:function(){var minuteAll=5*this.value,h=parseInt(minuteAll/60),minute=minuteAll%60;return h+":00"}},minPadding:0,maxPadding:0,startOnTick:!1,endOnTick:!1,tickPositions:[0,12,24,36,48,60,72,84,96,108,120,132,144,156,168,180,192,204,216,228,240,252,264,276,288],tickWidth:1,min:0,max:287},colorAxis:{stops:[[0,"#41a30d"],[.5,"#fffbbc"],[1,"#c4463a"]],min:0,max:40},series:[{data:dataList,borderWidth:0,colsize:36e5*24,nullColor:"#b7b7b7",color:"#3060cf",tooltip:{pointFormatter:function(){var minuteAll=5*this.y,h=parseInt(minuteAll/60),minute=minuteAll%60,b=moment(this.x);if(null!==this.value){if(0===this.value){return b.format("D MMMM YYYY")+" "+h+":"+minute+" <b>\u0E44\u0E21\u0E48\u0E21\u0E35\u0E01\u0E32\u0E23\u0E2A\u0E48\u0E07\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25\u0E25\u0E48\u0E32\u0E0A\u0E49\u0E32</b>"}else{return b.format("D MMMM YYYY")+" "+h+":"+minute+" <b>\u0E25\u0E48\u0E32\u0E0A\u0E49\u0E32 "+this.value+" \u0E0A\u0E31\u0E48\u0E27\u0E42\u0E21\u0E07</b>"}}else{return b.format("D MMMM YYYY")+" "+h+":"+minute+" <b>\u0E44\u0E21\u0E48\u0E21\u0E35\u0E01\u0E32\u0E23\u0E2A\u0E48\u0E07\u0E02\u0E49\u0E2D\u0E21\u0E39\u0E25</b>"}}}}],credits:{enabled:!1}})}}onBatteryDailyDataChanged(batteryDailyData){if(batteryDailyData){var observedData=batteryDailyData[0].data,batteryDailyDataArray=[];for(let index=0;index<observedData.length;index++){const element=observedData[index];var b=moment(element.observed_timestamp);batteryDailyDataArray.push([b.toDate().getTime(),element.value])}this.dataList.battery=batteryDailyDataArray;this.initChart()}else{if(batteryDailyData===void 0){this.dataList.battery=[]}}}onSignalDailyDataChanged(signalDailyData){if(signalDailyData){var observedData=signalDailyData[0].data,signalDailyDataArray=[];for(let index=0;index<observedData.length;index++){const element=observedData[index];var b=moment(element.observed_timestamp);signalDailyDataArray.push([b.toDate().getTime(),element.value])}this.dataList.signal=signalDailyDataArray;this.initChart()}else{if(signalDailyData===void 0){this.dataList.signal=[]}}}initChart(){if(this.dataList.signal!==void 0&&this.dataList.battery!==void 0){if(0!==this.dataList.signal.length&&0!==this.dataList.battery.length){var chartData={datasets:[{name:"\u0E41\u0E1A\u0E15\u0E40\u0E15\u0E2D\u0E23\u0E35\u0E48",data:this.dataList.battery,unit:"\u0E42\u0E27\u0E25\u0E15\u0E4C",type:"spline",valueDecimals:1,min:0,max:20},{name:"\u0E2A\u0E31\u0E0D\u0E0D\u0E32\u0E13\u0E01\u0E32\u0E23\u0E2A\u0E37\u0E48\u0E2D\u0E2A\u0E32\u0E23",data:this.dataList.signal,unit:"",type:"spline",valueDecimals:1,min:0,max:50}]};if(this.chart){this.clearData();this.addDataToChart(chartData)}else{this.createChart(chartData)}}else{}}}addDataToChart(chartData){chartData.datasets.forEach(function(dataset,i){var tmp={data:dataset.data,name:dataset.name,type:dataset.type,color:Highcharts.getOptions().colors[i],fillOpacity:1,tooltip:{valueSuffix:" "+dataset.unit}};this.chart[i].addSeries(tmp,!0,!0)}.bind(this))}addData(station_id,station_name,dataAdd,color,timeXScale_hr){if(null!==this.chart){var series=this.chart.get(station_id);if(series===void 0){var tmp={id:station_id,name:station_name,data:dataAdd};if(color!==void 0){tmp.color=color}this.chart.addSeries(tmp,!0,!0)}}}clearData(){for(let index=0;index<this.chart.length;index++){const element=this.chart[index];for(var i=0;i<element.series.length;i++){element.series[i].remove(!1);i--}}}createActionFunction(){["mousemove","touchmove","touchstart"].forEach(function(eventType){this.$.linechart.addEventListener(eventType,function(e){var chart,point,i,event;for(i=0;i<Highcharts.charts.length;i=i+1){chart=Highcharts.charts[i];if(chart!==void 0){event=chart.pointer.normalize(e);point=chart.series[0].searchPoint(event,!0);if(point){point.highlight(e)}}}})}.bind(this));Highcharts.Point.prototype.highlight=function(event){event=this.series.chart.pointer.normalize(event);this.onMouseOver();this.series.chart.tooltip.refresh(this);this.series.chart.xAxis[0].drawCrosshair(event,this)};Highcharts.Pointer.prototype.reset=function(){return}}createChart(activity){var chartList=[];activity.datasets.forEach(function(dataset,i){var headerDiv=document.createElement("div");headerDiv.className="header_chart";var html="<p>"+dataset.name+"";if(""!==dataset.unit){html=html+"<br/>("+dataset.unit+")"}html=html+"</p>";headerDiv.innerHTML=html;var chartDiv=document.createElement("div");chartDiv.className="chart";this.$.linechart.appendChild(headerDiv);this.$.linechart.appendChild(chartDiv);var colors=["#7cb5ec","#90ed7d","#45a6f0","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"],chart=Highcharts.chart(chartDiv,{chart:{backgroundColor:"rgba(255, 255, 255, 0.0)",marginLeft:40,spacingTop:20,spacingBottom:20},title:{text:"",align:"left",margin:0,x:30},credits:{enabled:!1},legend:{enabled:!1},xAxis:{className:"tpb_font",type:"datetime",crosshair:!0,tickInterval:1e3*3600,events:{setExtremes:this.syncExtremes},labels:{}},yAxis:{gridLineWidth:.2,title:{text:null},min:dataset.min,max:dataset.max},tooltip:{pointFormatter:function(){var b=moment(this.x);return b.format("D MMMM YYYY HH.mm")+" \u0E19. : "+this.y+" "+dataset.unit},headerFormat:"",shadow:!1,style:{fontSize:"14px",fontFamily:"Prompt, sans-serif"},valueDecimals:dataset.valueDecimals},series:[{data:dataset.data,name:dataset.name,type:dataset.type,color:colors[i],fillOpacity:1,tooltip:{valueSuffix:" "+dataset.unit},lineWidth:1}]});chartList.push(chart)}.bind(this));this.chart=chartList;if(!this.createAction){this.createAction=!0;this.createActionFunction()}}syncExtremes(e){var thisChart=this.chart;if("syncExtremes"!==e.trigger){Highcharts.each(Highcharts.charts,function(chart){if(chart!==thisChart){if(chart.xAxis[0].setExtremes){chart.xAxis[0].setExtremes(e.min,e.max,void 0,!1,{trigger:"syncExtremes"})}}})}}constructor(){super()}ready(){super.ready();Polymer.RenderStatus.afterNextRender(this,function(){moment.locale("th")})}}window.customElements.define(PageSending.is,PageSending);</script></dom-module></body></html>